---
// src/components/SearchBar/SearchBar.astro
interface Props {
  size?: 'small' | 'large';
}
const { size = 'large' } = Astro.props;
---

<div class:list={["search-wrapper", { "search-wrapper--small": size === 'small' }]}>
  <!-- El action y method son un buen fallback si JS falla -->
  <form class="search-form" action="/search" method="get">
    <input
      type="search"
      name="q" 
      placeholder="Buscar en el sitio..."
      aria-label="Campo de b칰squeda"
      class="search-input"
    />
    <button type="submit" class="search-button" aria-label="Buscar">
      游댌
    </button>
  </form>
</div>

<!-- A칌ADIMOS EL SCRIPT PARA LA INTERACTIVIDAD -->
<script>
  // Seleccionamos todos los formularios de b칰squeda en la p치gina
  document.querySelectorAll('.search-form').forEach(form => {
    form.addEventListener('submit', (event) => {
      // 1. Prevenimos el comportamiento por defecto (recargar la p치gina)
      event.preventDefault(); 
      
      // 2. Obtenemos el campo de texto dentro de este formulario espec칤fico
      const input = form.querySelector('.search-input') as HTMLInputElement;
      const query = input.value.trim();

      // 3. Si hay algo escrito, redirigimos a la p치gina de b칰squeda
      if (query) {
      const newUrl = `/search?q=${encodeURIComponent(query)}`;
      history.pushState({}, "", newUrl);

      // Lanzamos evento para que search.astro vuelva a ejecutar
      window.dispatchEvent(new Event("search:changed"));
    }
    });
  });
</script>

<style lang="scss">
  @use 'sass:color';
  @use '../../styles/variables' as var;

  /* --- ESTILOS BASE (GRANDE - POR DEFECTO) --- */
  .search-wrapper {
    display: flex;
    justify-content: center;
    width: 100%;
    padding: 1rem 0;
  }

  .search-form {
    display: flex;
    align-items: center;
    width: 100%;
    max-width: 500px;
    background-color: #fff;
    border-radius: 9999px; // P칤ldora
    border: 2px solid var.$primary-color;
    overflow: hidden;
    transition: box-shadow 0.2s ease;

    &:focus-within {
      box-shadow: 0 0 0 3px rgba(var.$primary-color, 0.5);
    }
  }

  .search-input {
    flex-grow: 1;
    height: 48px;
    padding: 0 1.25rem;
    border: none;
    background: transparent;
    font-size: 1rem;
    color: #333;

    &::placeholder {
      color: #888;
      opacity: 1;
    }
    &::-webkit-search-decoration,
    &::-webkit-search-cancel-button {
      -webkit-appearance: none;
    }
    &:focus {
      outline: none;
    }
  }

  .search-button {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-shrink: 0;
    width: 60px;
    height: 48px;
    background-color: var.$primary-color;
    border: none;
    cursor: pointer;
    color: #1e1e1e;
    transition: background-color 0.2s ease;

    &:hover {
      background-color: color.adjust(var.$primary-color, $lightness: 10%);
    }
  }


  /* --- 4. ESTILOS PARA LA VERSI칍N PEQUE칌A --- */
  /*    Estos estilos se aplicar치n solo cuando el wrapper
        tenga la clase 'search-wrapper--small'. */
  
  .search-wrapper--small {
    padding: 2rem 0; // Le damos un poco m치s de aire vertical
    
    .search-form {
      max-width: 400px; // Un poco m치s angosto
      border-width: 1px; // Un borde m치s sutil
    }

    .search-input {
      height: 40px; // Menos alto
      font-size: 0.9rem; // Texto m치s peque침o
      padding: 0 1rem;
    }

    .search-button {
      width: 50px; // Bot칩n m치s peque침o
      height: 40px;
      font-size: 1.1rem; // Emoji un poco m치s peque침o
    }
  }
</style>