---
// src/components/PostCard/PostCard.astro
import { Image } from "astro:assets";
// 1. Importamos el tipo de la 'data' de nuestra colección, no la entrada completa.
import type { CollectionEntry } from "astro:content";

// 2. Definimos un tipo para la 'data' que esperamos, incluyendo nuestra 'coverImage'
type PostData = CollectionEntry<'blog'>['data'] & { coverImage: any };

// 3. CAMBIO CLAVE: En lugar de una prop 'post', pedimos 'slug' y 'data' por separado.
// Esto desacopla el componente del objeto 'CollectionEntry' completo.
interface Props {
  slug: string;
  data: PostData;
}

const { slug, data } = Astro.props;
---

<!-- 4. Ahora usamos 'slug' y 'data' directamente, en lugar de 'post.slug' y 'post.data' -->
<div class="post-card">
  <a href={`/blog/${slug}/`} class="card-image-link" aria-label={`Leer más sobre ${data.title}`}>
    {data.coverImage ? (
      <Image
        src={data.coverImage}
        alt={`Imagen de portada para ${data.title}`}
        widths={[240, 540, 720]}
        sizes={`(min-width: 768px) 33vw, 80px`}
        format="webp"
        quality={"high"}
        class="card-image"
      />
    ) : (
      <div class="image-placeholder"></div>
    )}
  </a>
  <div class="card-content">
    <a href={`/blog/${slug}/`} class="card-title-link">
      <h2>{data.title}</h2>
    </a>
    <p>{data.description}</p>
    <time datetime={data.pubDate.toISOString()}>
      {new Date(data.pubDate).toLocaleDateString('es-ES', {
        year: 'numeric', month: 'long', day: 'numeric',
      })}
    </time>
    {data.externalUrl && (
      <div class="external-link-wrapper">
        <a href={data.externalUrl} class="external-button" target="_blank" rel="noopener noreferrer">
          Visitar Página →
        </a>
      </div>
    )}
  </div>
</div>

<!-- Copiamos los estilos EXACTOS de la tarjeta aquí para encapsularlos -->
<style lang="scss">
  @use '../../styles/variables' as var;
  @use 'sass:color'; // Corregimos la advertencia de una vez

  .post-card {
    display: flex;
    gap: 1rem;
    background-color: #2a2a2a;
    border: 1px solid #444;
    border-radius: 12px;
    padding: 1rem;
    transition: border-color 0.2s ease;

    &:hover { border-color: #555; }
  }

  .card-image-link { flex-shrink: 0; }
  .card-image, .image-placeholder {
    width: 80px; height: 80px; object-fit: cover; border-radius: 8px;
    background-color: #333; // Color para el placeholder
  }
  
  .card-content {
    display: flex; flex-direction: column; justify-content: center;
  }

  .card-title-link {
    text-decoration: none;
    h2 {
      font-size: 1.25rem; margin: 0 0 0.5rem 0; color: var.$primary-color; transition: color 0.2s ease;
    }
    &:hover h2 {
      color: color.adjust(var.$primary-color, $lightness: 15%);
    }
  }

  .card-content p {
    font-size: 0.9rem; color: #ccc; margin: 0; line-height: 1.5;
  }

  .card-content time {
    font-size: 0.8rem; color: #aaa; margin-top: 0.5rem;
  }
  
  .external-link-wrapper { margin-top: 0.75rem; }
  .external-button {
    display: inline-block; background-color: #333; color: var.$primary-color; text-decoration: none;
    padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.8rem; font-weight: bold;
    border: 1px solid #555; transition: background-color 0.2s ease, color 0.2s ease;
    &:hover {
      background-color: var.$primary-color; color: #121212;
    }
  }

  @media (min-width: 768px) {
    .post-card {
      flex-direction: column; padding: 0;
    }

    .card-image, .image-placeholder {
      width: 100%; height: auto; aspect-ratio: 16 / 10; border-radius: 12px 12px 0 0;
    }
    
    .card-content { padding: 1.5rem; }
    .card-title-link h2 { font-size: 1.5rem; }
    .card-content p { font-size: 1rem; }
    .card-content time { font-size: 0.875rem; }
  }
</style>