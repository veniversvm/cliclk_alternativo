---
// src/components/Post-Card/PostCard.astro

import type { CollectionEntry } from "astro:content";
import type { ImageMetadata } from "astro";

type PostData = CollectionEntry<'blog'>['data'] & { coverImage?: ImageMetadata | null };

interface Props {
  slug: string;
  data: PostData;
}

const { slug, data } = Astro.props;

const imageUrl = data.coverImage ? data.coverImage.src : null;
---

<div class="post-card">
  <a href={`/blog/${slug}`} class="card-image-link" aria-label={`Leer más sobre ${data.title}`}>
    
    {imageUrl ? (
      <img
        src={imageUrl}
        alt={`Imagen de portada para ${data.title}`}
        class="card-image"
        loading="lazy"
        decoding="async"
      />
    ) : (
      <div class="image-placeholder"></div>
    )}
  </a>
  <div class="card-content">
    <a href={`/blog/${slug}`} class="card-title-link">
      <h2>{data.title}</h2>
    </a>
    <p>{data.description}</p>
    <time datetime={data.pubDate.toISOString()}>
      {new Date(data.pubDate).toLocaleString('es-ES', {
        year: 'numeric', month: 'long', day: 'numeric',
      })}
    </time>
    {data.externalUrl && (
      <div class="external-link-wrapper">
        <a href={data.externalUrl} class="external-button" target="_blank" rel="noopener noreferrer">
          Visitar Página →
        </a>
      </div>
    )}
  </div>
</div>

<!-- Los estilos están completos y no necesitan cambios -->
<style lang="scss">
  @use '../../styles/variables' as var;
  @use 'sass:color';

  .post-card {
    display: flex;
    gap: 1rem;
    background-color: #2a2a2a;
    border: 1px solid #444;
    border-radius: 12px;
    padding: 1rem;
    transition: border-color 0.2s ease;

    &:hover { border-color: #555; }
  }

  .card-image-link { flex-shrink: 0; }
  .card-image, .image-placeholder {
    width: 80px; height: 80px; object-fit: cover; border-radius: 8px;
    background-color: #333;
  }
  
  .card-content {
    display: flex; flex-direction: column; justify-content: center;
  }

  .card-title-link {
    text-decoration: none;
    h2 {
      font-size: 1.25rem; margin: 0 0 0.5rem 0; color: var.$primary-color; transition: color 0.2s ease;
    }
    &:hover h2 {
      color: color.adjust(var.$primary-color, $lightness: 15%);
    }
  }

  .card-content p {
    font-size: 0.9rem; color: #ccc; margin: 0; line-height: 1.5;
  }

  .card-content time {
    font-size: 0.8rem; color: #aaa; margin-top: 0.5rem;
  }
  
  .external-link-wrapper { margin-top: 0.75rem; }
  .external-button {
    display: inline-block; background-color: #333; color: var.$primary-color; text-decoration: none;
    padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.8rem; font-weight: bold;
    border: 1px solid #555; transition: background-color 0.2s ease, color 0.2s ease;
    &:hover {
      background-color: var.$primary-color; color: #121212;
    }
  }

  @media (min-width: 768px) {
    .post-card {
      flex-direction: column; padding: 0;
    }

    .card-image, .image-placeholder {
      width: 100%; height: auto; aspect-ratio: 16 / 10; border-radius: 12px 12px 0 0;
    }
    
    .card-content { padding: 1.5rem; }
    .card-title-link h2 { font-size: 1.5rem; }
    .card-content p { font-size: 1rem; }
    .card-content time { font-size: 0.875rem; }
  }
</style>